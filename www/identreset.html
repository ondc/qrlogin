<html>
<head>
<title>QR Passport</title>
<link rel="stylesheet" href="mobile_styles.css" type="text/css" />
<meta name="viewport" content="width=device-width">

<script src="libs/common.js" type="text/javascript"></script>
</head>

<body onload="start()">
<p><span id="host">Host</span>: <span id="serviceId"></span></p>
<p><button id="save">Backup keys</button></p>
<p><button id="delete">Delete keys</button></p>


<script type="text/javascript">

var args = location.hash.substr(1).split(',');
var lang = args[0];
var host = args[1];

function saveAs(uri, filename) {
    var link = document.createElement('a');
      document.body.appendChild(link); // Firefox requires the link to be in the body
      link.download = filename;
      link.href = uri;
      link.click();
      document.body.removeChild(link); // remove the link when done
}



function featureTest() {
	
	if (localStorage) return true;
	alert(langtab["feature_test_failed"]);
	return false;
}


function run() {

	var save = document.getElementById("save");
	var erase = document.getElementById("delete");
	var serviceId = document.getElementById("serviceId");
	var hostitem =  document.getElementById("host");
	langSetText(save,"backup");
	langSetText(erase,"erase");
	langSetText(hostitem,"host");
	serviceId.appendChild(document.createTextNode(host));
	save.addEventListener("click",function(){
		saveAs("data:application/octet-stream;charset=utf-8,"+encodeURIComponent(localStorage["secretKey"]),"qrlogin_backup.json");
	});
	erase.addEventListener("click",function(){
		if (confirm(langtab["confirm_reset"])) {
			var keystore = localStorage["secretKey"]?JSON.parse(localStorage["secretKey"]):{}
			delete keystore[host];
			localStorage["secretKey"] = JSON.stringify(keystore);
			alert(langtab["erased"]);
		}		
	});
	
		
}

	
function start() {
	loadLang(lang,function() {
		if (featureTest()) {
			run();
		}		
	});
}	

</script>


</body>

</html>